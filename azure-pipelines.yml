# Flutter build
variables:
  projectDirectory: 'BudgetTracker-Mobile'

trigger:
- master

jobs:
  - job: Android
    timeoutInMinutes: 10
    pool:
      vmImage: 'macOS-latest'
    steps:
      - task: XplatGenerateReleaseNotes@3
        inputs:
          outputfile: '$(Build.ArtifactStagingDirectory)\releasenotes.md'
          templateLocation: 'InLine'
          inlinetemplate: |
            # Release notes for build $(Build.DefinitionName)
            **Build Number**  : $($build.buildnumber)
            **Build started** : $("{0:dd/MM/yy HH:mm:ss}" -f [datetime]$build.startTime)
            **Source Branch** : $($build.sourceBranch)
            ### Associated work items
            @@WILOOP@@
            * **$($widetail.fields.'System.WorkItemType') $($widetail.id)** [Assigned by: $($widetail.fields.'System.AssignedTo')]     $($widetail.fields.'System.Title')
            @@WILOOP@@
            ### Associated change sets/commits
            @@CSLOOP@@
            * **ID $($csdetail.changesetid)$($csdetail.commitid)** $($csdetail.comment)
            @@CSLOOP@@
          gitHubPat: '$(gitpattoken)'
          dumpPayloadToConsole: false
          dumpPayloadToFile: false
          replaceFile: true
          getParentsAndChildren: false

      - task: CopyFiles@2
        inputs:
          contents: '**/*.apk'
          targetFolder: '$(build.artifactStagingDirectory)'
          
      - task: PublishBuildArtifacts@1
        inputs:
          PathtoPublish: '$(Build.ArtifactStagingDirectory)'
          ArtifactName: 'development'
          publishLocation: 'Container'